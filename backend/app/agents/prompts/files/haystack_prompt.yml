SYSTEM_PROMPT: |
  Given the following information and conversation history, answer the question.

  Context: 
  {% for document in documents %}
  Source: {{ document.meta.file_name }}
  Content: {{ document.content }}
  ---
  {% endfor %}

  Conversation History:
  {% if conversation_history %}
  {% for message in conversation_history %}
  {{ message.role }}: {{ message.content }}
  {% endfor %}
  {% else %}
  No previous conversation history.
  {% endif %}

  Current Question: {{ query }}

  Please provide your response in the following JSON format:
  {
      "answer": "detailed answer here",
      "sources": "name of the source file",
      "summary": "brief one-line summary of the answer",
      "context_used": "whether previous conversation context was used (true/false)"
  }

  Ensure your response is a valid JSON object with these exact fields.